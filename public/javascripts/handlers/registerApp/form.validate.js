function regApp(e){var a='<svg width="10px"  height="10px"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-rolling" style="background: none;"><circle cx="50" cy="50" fill="none" stroke="#fafafa" stroke-width="10" r="35" stroke-dasharray="164.93361431346415 56.97787143782138" transform="rotate(353.928 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></circle></svg>',c=$("#register-app_form").validate({errorContainer:".box-messages",errorClass:"text-danger",rules:{formDomainName:{required:!0,minlength:6},"step_3-host":{required:!0,minlength:4},"step_3-db-name":{required:!0},"step_3-user":{required:!0,minlength:2},"step_3-password":{required:!0,minlength:8},"step_3-table-name":{required:!0,minlength:2},"step_3-db-port":{minlength:2},"step_3-db-type":{required:!0},"step_3-col-user_id":{required:!0},"step_3-col-user_email":{required:!0},"step_3-col-user_phone":{required:!0},"step_3-col-user_password":{required:!0}},messages:{formDomainName:{required:"Пожалуйста, введите ссылку на ресурс вида http://domainname.ru/",url:"Пожалуйста, введите корректный адрес"},"step_3-host":{required:"Хост базы данных"},"step_3-db-name":{required:"Имя базы данных"},"step_3-user":{required:"Пользователь базы данных"},"step_3-password":{required:"Пароль пользователя базы данных",minlength:"Минимальная длина от 8 символов"},"step_3-table-name":{required:"Имя таблицы содержащее пользователей"},"step_3-db-port":{required:"Порт подключения"},"step_3-db-type":{required:"Тип СУБД"},"step_3-col-user_id":{required:"Имя поля user_id"},"step_3-col-user_email":{required:"Имя поля user_email"},"step_3-col-user_phone":{required:"Имя поля user_phone"},"step_3-col-user_password":{required:"Имя поля user_password"}}}),t="#formDomainName",u={host:"#step_3-host",database:"#step_3-db-name",user:"#step_3-user",password:"#step_3-password",tableName:"#step_3-table-name",port:"#step_3-db-port",dbType:"#step_3-db-type",cols:{user_id:"#step_3-col-user_id",user_password:"#step_3-col-user_password",user_email:"#step_3-col-user_email",user_phone:"#step_3-col-user_phone"}};this.checkDomainName=function(){var s=$(t).val(),e={url:s};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/app/add/url",cache:!1,beforeSend:function(){$(".btnCheckDomainName").append(a)},complete:function(){$(".btnCheckDomainName").find("svg").remove()}}).done(function(e){if(e.ok){App.setDomainName(s),$("#test-l-1").prepend('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Успех! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$(".btn-contolls").find(".res-step-1").addClass("d-block"),$(".btn-contolls").find(".btnCheckDomainName").remove();var t=s+"/"+App.getAppObject().secretKey+".html";$("#test-l-2").find(".domainName").text(s).attr("href",s),$("#test-l-2").find(".secretKey").text(App.getAppObject().secretKey),$("#test-l-2").find(".file-link").text(t).attr("href",t),console.log(App.getAppObject())}else $("#test-l-1").prepend('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Ошибка! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),console.log(e)})},this.checkRightsMeta=function(){var e={url:App.getAppObject().domainName,secretKey:App.getAppObject().secretKey};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/app/add/rights/meta",cache:!1,beforeSend:function(){$(".btnCheckRights").append(a)},complete:function(){$(".btnCheckRights").find("svg").remove()}}).done(function(e){e.ok?(App.setRights(),$("#test-l-2").prepend('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Успех! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$(".btn-contolls").find(".btnCheckRights").addClass("d-none"),$(".btn-contolls").find(".res-step-2").addClass("d-block"),console.log(App.getAppObject())):$("#test-l-2").prepend('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Ошибка! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),console.log(e)})},this.checkRightsHtml=function(){var e={url:App.getAppObject().domainName,secretKey:App.getAppObject().secretKey};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/app/add/rights/html",cache:!1,beforeSend:function(){$(".btnCheckRights").append(a)},complete:function(){$(".btnCheckRights").find("svg").remove()}}).done(function(e){e.ok?(App.setRights(),$("#test-l-2").prepend('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Успех! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$(".btn-contolls").find(".btnCheckRights").addClass("d-none"),$(".btn-contolls").find(".res-step-2").addClass("d-block"),console.log(App.getAppObject())):$("#test-l-2").prepend('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Ошибка! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),console.log(e)})},this.checkDBData=function(){var t={host:$(u.host).val(),database:$(u.database).val(),user:$(u.user).val(),password:$(u.password).val(),tableName:$(u.tableName).val(),port:$(u.port).val()||"",dbType:$(u.dbType).val()};$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/app/add/db",cache:!1,beforeSend:function(){$(".btncheckDBData").append(a)},complete:function(){$(".btncheckDBData").find("svg").remove()}}).done(function(e){e.ok?(App.setDBData(t.host,t.database,t.user,t.password,t.port,t.tableName,t.dbType),$("#test-l-3").prepend('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Успех! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$(".btn-contolls").find(".btncheckDBData").addClass("d-none"),$(".btn-contolls").find(".res-step-3").addClass("d-block"),e.cols.forEach(function(e,t,s){$(".step_3_cols select").append('<option value="'+e+'">'+e+"</option>")})):$("#test-l-3").prepend('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Ошибка! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>')}),console.log(App.getAppObject())},this.setDBCols=function(){var e=$(u.cols.user_id).val(),t=$(u.cols.user_password).val(),s=$(u.cols.user_email).val(),a=$(u.cols.user_phone).val(),o=c.element(u.cols.user_id),r=c.element(u.cols.user_password),n=c.element(u.cols.user_email),l=c.element(u.cols.user_phone);if(o&&r&&n&&l){App.setDBcol(e,t,s,a),$(".setDBCols").addClass("d-none"),$(".res-step-4").addClass("d-block");var i=["Ключ проверки","Домен","Подтверждение прав","Хост БД","Имя БД","Логин БД","Пароль БД","Порт","Имя талицы","Тип Базы данных","Поле 1","Поле 2","Поле 3","Поле 4"],p=App.getAppObject(),d=0;console.log(p),function e(t){for(var s in t)"object"==typeof t[s]?(e(t[s]),console.log("obj[key]"),console.log(t[s]),console.log("//obj[key]")):($("#app-info").append('<div class="db-fields_line"><div class="db_name">'+i[d]+' : </div> <div class="db_val"> '+t[s]+"</div></div>"),d++)}(p)}console.log(App.getAppObject())},this.saveData=function(){var e=App.getAppObject(),t={url:e.domainName,secretKey:e.secretKey,host:e.DBData.host,database:e.DBData.database,user:e.DBData.user,password:e.DBData.password,tableName:e.DBData.tableName,port:e.DBData.port,dbType:e.DBData.DBtype,col_user_id:e.DBData.cols.user_id,col_user_password:e.DBData.cols.user_password,col_user_email:e.DBData.cols.user_email,col_user_phone:e.DBData.cols.user_phone};$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/app/add/save",cache:!1,beforeSend:function(){$(".btnSaveApp").append(a)},complete:function(){$(".btnSaveApp").find("svg").remove()}}).done(function(e){e.ok?(console.log("OKS"),$("#test-l-5").prepend('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Успех! </strong>'+e.msg+' <a href="/settings/">Перейти в настройки</a><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>')):(console.log("FAIL"),$("#test-l-5").prepend('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Ошибка! </strong>'+e.msg+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'))})};var s=this;e.onclick=function(e){var t=e.target.getAttribute("data-action");t&&s[t]()}}new regApp(regAppForm);